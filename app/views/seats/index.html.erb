<%= include_gon %>

<div ng-app="app">
  {{ 1 + 1 }}
<div id="seat" ng-controller="seatsCtrl" ng-init="setup(<%= @venue.id %>)">

<div class="se-pre-con"></div>
<h3><%= @venue.name %></h3>
<h1>Seating Chart</h1>
<br>
<a href="/venues/<%= @venue.id %>" role="button" class="back-button btn btn-default">Back to Venue</a>
<br><br>

<% if @venue.seating_chart %>
  <canvas id="seating" width="1200" height="700">This browser does not support the canvas element</canvas>

  <% if current_user && current_user.admin || current_user && current_user.id == @venue.user_id %>
  <h3>Current Seating Information</h3>
      <br>
      <div id="seating-pages">
        <form class="form-inline">
          <div class="form-group">
              <input type="text" ng-model="search" class="form-control" placeholder="search seats">
          </div>
        </form>

        <table class="table table-striped">
          <tr>
            <th width="150px" ng-click="sort('seat_section')">Section <span class="glyphicon sort-icon" ng-show="sortKey=='seat_section'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span></th>
            <th width="100px" ng-click="sort('seat_row')">Row <span class="glyphicon sort-icon" ng-show="sortKey=='seat_row'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span></th>
            <th width="120px" ng-click="sort('seat_number')">Seat Number <span class="glyphicon sort-icon" ng-show="sortKey=='seat_number'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span></th>
            <th width="100px">Seat Photos</th>
            <th width="100px">Add Your Own!</th>
          </tr>
          <tr dir-paginate="seat in seatInfo.seats | orderBy:sortKey:reverse | filter:search | itemsPerPage: 10">
            <td>{{ seat.seat_section }}</td>
            <td>{{ seat.seat_row }}</td>
            <td>{{ seat.seat_number }}</td>
            <td>view photos</td>
            <td>add photo</td>
          </tr>
        </table>
        <dir-pagination-controls>
          [direction-links="true"]
          [boundary-links="true"]
        </dir-pagination-controls>
      </div>

  <% end %>
<% else %>
  <h3>Seating Chart Not Currently Available for This Venue</h3>
  <br>
  <% if current_user && current_user.admin || current_user && current_user.id == @venue.user_id %>
    <div>
      <%= link_to "Add Seat", "/venues/#{@venue.id}/seats/new", :class =>"btn btn-default btn-xs active" %> 
    </div>
  <% end %>
  <% if @seats[0] %>
    <h3>Available seat information listed below</h3>
    <br>
    <div id="seating-pages">
      <form class="form-inline">
        <div class="form-group">
            <input type="text" ng-model="search" class="form-control" placeholder="search seats">
        </div>
      </form>

      <table class="table table-striped">
        <tr>
          <th width="150px" ng-click="sort('seat_section')">Section <span class="glyphicon sort-icon" ng-show="sortKey=='seat_section'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span></th>
          <th width="100px" ng-click="sort('seat_row')">Row <span class="glyphicon sort-icon" ng-show="sortKey=='seat_row'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span></th>
          <th width="120px" ng-click="sort('seat_number')">Seat Number <span class="glyphicon sort-icon" ng-show="sortKey=='seat_number'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span></th>
          <th width="100px">Seat Photos</th>
          <th width="100px">Add Your Own!</th>
        </tr>
        <tr dir-paginate="seat in seatInfo.seats | orderBy:sortKey:reverse | filter:search | itemsPerPage: 10">
          <td>{{ seat.seat_section }}</td>
          <td>{{ seat.seat_row }}</td>
          <td>{{ seat.seat_number }}</td>
          <td>view photos</td>
          <td>add photo</td>
        </tr>
      </table>
      <dir-pagination-controls>
        [direction-links="true"]
        [boundary-links="true"]
      </dir-pagination-controls>
    </div>
  <% end %>
<% end %>

<% if current_user && current_user.admin || current_user && current_user.id == @venue.user_id %>
  <br>
 
  <% if @sections[0] %>
    <h3>Current Venue Sections</h3>
    <div>
      <a href="/venues/<%= @venue.id %>/sections/new" rel="nofollow" role="button" class="btn btn-default btn-xs active">Add Section</a>
    </div>
    <br>
   <table>
    <tr>
      <th>Section Id</th>     
      <th>Section Name</th>
      <th>Number of Rows</th>
      <th></th>
      <th></th>
    </tr>
    <% @sections.each do |section| %>
      <tr>
        <td width="100px"><%= section.id %></td>     
        <td width="240px"><%= section.name %></td>
        <td width="240px"><%= section.number_rows %></td>
        <td><a href="/sections/<%= section.id %>/rows/new" rel="nofollow" role="button" class="btn btn-default btn-xs active">Add Row</a></td>
        <td><a href="/venues/<%= @venue.id %>/sections/<%= section.id %>/edit" rel="nofollow" role="button" class="btn btn-default btn-xs active">Edit Section</a></td>
        <td><a data-confirm="Are you sure you want to delete this section?" data-method="delete" href="/venues/<%= @venue.id %>/sections/<%= section.id %>" rel="nofollow" role="button" class="btn btn-default btn-xs active">Delete Section</a></td>
      </tr>
    <% end %>
    </table>
  <% else %>
    <h3>Current Venue Sections</h3>
    <div>
      <a href="/venues/<%= @venue.id %>/sections/new" rel="nofollow" role="button" class="btn btn-default btn-xs active">Add Section</a>
     </div>
    <br>
    <p>No sections have been added</p>
  <% end %>
  <br>
  <% if @rows[0] %>
    <h3>Current Venue Rows</h3>
     <table>
      <tr>
        <th>Row Id</th>     
        <th>Section Id</th>     
        <th>Row Name</th>
        <th>Number of Seats</th>
        <th></th>
        <th></th>
      </tr>
    <% @rows.each do |row| %>
      <tr>
        <td width="100px"><%= row.id %></td>     
        <td width="100px"><%= row.section_id %></td>     
        <td width="100px"><%= row.name %></td>
        <td width="150px"><%= row.number_seats %></td>
        <td><a href="/sections/<%= row.section_id %>/rows/<%= row.id %>/edit" rel="nofollow" role="button" class="btn btn-default btn-xs active">Edit Row</a></td>
        <td><a data-confirm="Are you sure you want to delete this section?" data-method="delete" href="/sections/<%= row.section_id %>/rows/<%= row.id %>" rel="nofollow" role="button" class="btn btn-default btn-xs active">Delete Row</a></td>
      </tr>
    <% end %>
    </table>
  <% else %>
    <h3>Current Venue Rows</h3>
    <p>No rows have been added.</p>
  <% end %>
<% end %>

</div>
</div>

<script>
  $(function(){
    window.seatData = <%= @seat_data.html_safe %>;

    callSeating();
  });
</script>
  
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/modernizr/2.8.2/modernizr.js"></script>




